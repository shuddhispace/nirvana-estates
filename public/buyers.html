<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Buyers - Nirvana Estates</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { background-color: #f9fafb; }

.card { transition: transform .3s, box-shadow .3s; border-radius: 1rem; overflow: hidden; background: #fff; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
.card:hover { transform: translateY(-5px); box-shadow: 0 15px 30px rgba(0,0,0,0.15); }

.carousel { display: flex; overflow-x: auto; gap: 1rem; padding: 0.5rem; scroll-snap-type: x mandatory; scroll-behavior: smooth; cursor: grab; -webkit-overflow-scrolling: touch; }
.carousel:active { cursor: grabbing; }
.carousel::-webkit-scrollbar { display: none; }

.carousel-item { flex: 0 0 auto; scroll-snap-align: start; border-radius: 0.75rem; overflow: hidden; display: flex; justify-content: center; align-items: center; width: 250px; height: 350px; background: #000; }
@media(min-width:768px){ .carousel-item { width: 280px; height: 380px; } }
@media(min-width:1024px){ .carousel-item { width: 320px; height: 400px; } }

.short-media { width: 100%; height: 100%; object-fit: contain; border-radius: 0.75rem; transition: transform .3s; }
.short-media:hover { transform: scale(1.02); }

.card-body { padding: 1rem; display: flex; flex-direction: column; gap: 0.5rem; }

.card-body h3 { font-weight: 600; font-size: 1.125rem; color: #0f2b3d; }
.card-body span { font-weight: 700; color: #0f2b3d; }
.card-body p { font-size: 0.875rem; color: #555; }

.cta-btn { padding: 0.5rem 1rem; border-radius: 0.5rem; font-weight: 600; transition: all 0.2s; text-align: center; display: inline-block; }
.cta-view { background-color: #0f2b3d; color: #fff; }
.cta-view:hover { background-color: #15425c; }
.cta-call { background-color: #22c55e; color: #fff; }
.cta-call:hover { background-color: #16a34a; }

#grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
@media(min-width:768px){ #grid { grid-template-columns: repeat(2,1fr); } }
@media(min-width:1024px){ #grid { grid-template-columns: repeat(3,1fr); } }
</style>
</head>
<body class="text-gray-800">

<div id="header-placeholder"></div>
<script>
  fetch('header_main.html')
    .then(res=>res.text())
    .then(data=>document.getElementById('header-placeholder').innerHTML=data)
    .catch(err=>console.error(err));
</script>

<main class="max-w-7xl mx-auto px-4 py-6 space-y-6">
  <h2 class="text-2xl md:text-3xl font-bold text-gray-900">Properties for Buyers</h2>
  <div id="grid"></div>
</main>

<a href="tel:+917039199717" class="fixed bottom-4 right-4 z-50 bg-[#0f2b3d] text-white px-4 py-3 rounded-full shadow-lg font-semibold">
  ðŸ“ž Call Now
</a>

<script>
const INR = n => Number(n).toLocaleString('en-IN',{style:'currency',currency:'INR',maximumFractionDigits:0});
const BACKEND="https://nirvana-estates-backend.onrender.com";

function fixMediaUrl(src){ return src?.startsWith('http') ? src : `${BACKEND}/${src.replace(/^\/+/,'')}`; }

function createMediaSlide(src,type){
  const div=document.createElement('div'); div.className='carousel-item';
  if(type==='image'){
    const img=document.createElement('img'); img.src=fixMediaUrl(src); img.className='short-media'; div.appendChild(img);
  } else {
    let vidId='';
    if(src.includes('shorts/')) vidId=src.split('shorts/')[1].split('?')[0];
    else if(src.includes('youtu.be/')) vidId=src.split('youtu.be/')[1].split('?')[0];
    else if(src.includes('watch?v=')) vidId=src.split('watch?v=')[1].split('&')[0];
    const iframe=document.createElement('iframe');
    iframe.src=`https://www.youtube-nocookie.com/embed/${vidId}?rel=0`;
    iframe.allow='accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
    iframe.allowFullscreen=true; iframe.className='short-media'; div.appendChild(iframe);
  }
  return div;
}

function propertyCard(p){
  const card=document.createElement('div'); card.className='card flex flex-col';
  // carousel
  const carousel=document.createElement('div'); carousel.className='carousel';
  const media=[...(p.images||[]).map(s=>({src:s,type:'image'})), ...(p.videos||[]).map(s=>({src:s,type:'video'}))];
  if(media.length===0){
    const ph=document.createElement('div'); ph.className='carousel-item flex items-center justify-center text-gray-400 bg-gray-200'; ph.textContent='No Media'; carousel.appendChild(ph);
  } else media.forEach(m=>carousel.appendChild(createMediaSlide(m.src,m.type)));
  card.appendChild(carousel);

  // body
  const body=document.createElement('div'); body.className='card-body';
  const title=document.createElement('h3'); title.textContent=p.title||'Property'; body.appendChild(title);
  if(p.price){ const price=document.createElement('span'); price.textContent=INR(p.price); body.appendChild(price); }

  // meta
  const meta=[];
  if(p.bedrooms) meta.push(`${p.bedrooms} Bed`);
  if(p.bathrooms) meta.push(`${p.bathrooms} Bath`);
  if(p.carpetArea) meta.push(`Carpet: ${p.carpetArea} sq ft`);
  if(p.builtupArea) meta.push(`Built-up: ${p.builtupArea} sq ft`);
  if(p.location) meta.push(p.location);
  if(meta.length){ const sub=document.createElement('p'); sub.textContent=meta.join(' | '); body.appendChild(sub); }

  // CTA
  const ctaRow=document.createElement('div'); ctaRow.className='flex flex-wrap gap-2 mt-2';
  const viewBtn=document.createElement('a'); viewBtn.href=`property-details.html?id=${p._id}`; viewBtn.target='_blank'; viewBtn.className='cta-btn cta-view'; viewBtn.textContent='View Details';
  const callBtn=document.createElement('a'); callBtn.href='tel:+917039199717'; callBtn.className='cta-btn cta-call'; callBtn.textContent='Call';
  ctaRow.append(viewBtn, callBtn); body.appendChild(ctaRow);

  card.appendChild(body); return card;
}

async function load(){
  try{
    const res=await fetch(`${BACKEND}/api/properties`);
    const list=await res.json();
    const grid=document.getElementById('grid'); grid.innerHTML='';
    list.filter(p=>(p.category||'').toLowerCase()==='buyers').forEach(p=>grid.appendChild(propertyCard(p)));
  } catch(e){ console.error(e); document.getElementById('grid').innerHTML='<div class="text-red-600">Failed to load properties.</div>'; }
}
load();
</script>

<div class="bg-[#0f2b3d] text-gray-300 text-center text-sm py-4">
  Â© <span id="year"></span> Nirvana Estates. All rights reserved.
</div>
<script>document.getElementById('year').textContent=new Date().getFullYear();</script>
</body>
</html>
