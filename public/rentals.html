<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Properties - Nirvana Estates</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body { background-color: #f9fafb; }

  .card { transition: transform .3s, box-shadow .3s; }
  .card:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 15px 30px rgba(0,0,0,.15); }

  .carousel { display: flex; overflow-x: auto; scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; gap: 0.75rem; padding: 0.5rem 0; }
  .carousel::-webkit-scrollbar { display: none; }

  .carousel-item { flex: 0 0 100%; scroll-snap-align: start; display: flex; justify-content: center; align-items: center; }

  .media { width: auto; max-width: 280px; height: 500px; object-fit: cover; border-radius: 0.75rem; box-shadow: 0 6px 18px rgba(0,0,0,0.1); transition: transform .3s; }
  .media:hover { transform: scale(1.02); }

  @media(min-width:640px){ .carousel-item { flex: 0 0 48%; } }
  @media(min-width:1024px){ 
    #grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 1.5rem; }
    .media { max-width: 100%; height: 350px; }
  }
</style>
</head>
<body class="text-gray-800">

<!-- Header -->

<div id="header-placeholder"></div>
<script>
  fetch('header_main.html')
    .then(response => response.text())
    .then(data => {
      document.getElementById('header-placeholder').innerHTML = data;

      const menuToggle = document.getElementById('menu-toggle');
      const mobileMenu = document.getElementById('mobile-menu');
      const line1 = document.getElementById('line1');
      const line2 = document.getElementById('line2');
      const header = document.getElementById('header');
      const headerContent = document.getElementById('header-content');
      const logo = document.getElementById('logo');
      const nameImg = document.getElementById('name-img');

      // Apply slide animation classes
      mobileMenu.style.transition = "max-height 0.35s ease, opacity 0.35s ease";
      mobileMenu.style.overflow = "hidden";
      mobileMenu.style.maxHeight = "0";
      mobileMenu.style.opacity = "0";

      const toggleMenu = () => {
        const isOpening = mobileMenu.style.maxHeight === "0px" || mobileMenu.style.maxHeight === "0";
        
        if (isOpening) {
          mobileMenu.classList.remove('hidden');
          mobileMenu.style.maxHeight = mobileMenu.scrollHeight + "px";
          mobileMenu.style.opacity = "1";
          line1.style.transform = 'rotate(45deg) translate(4px, 4px)';
          line2.style.transform = 'rotate(-45deg) translate(4px, -4px)';
        } else {
          mobileMenu.style.maxHeight = "0";
          mobileMenu.style.opacity = "0";
          setTimeout(() => mobileMenu.classList.add('hidden'), 350);
          line1.style.transform = 'rotate(0deg) translate(0, 0)';
          line2.style.transform = 'rotate(0deg) translate(0, 0)';
        }
      };

      menuToggle.addEventListener('click', toggleMenu);

      // Close on menu link click
      mobileMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          mobileMenu.style.maxHeight = "0";
          mobileMenu.style.opacity = "0";
          setTimeout(() => mobileMenu.classList.add('hidden'), 350);
          line1.style.transform = 'rotate(0deg) translate(0, 0)';
          line2.style.transform = 'rotate(0deg) translate(0, 0)';
        });
      });

      // Close on click outside
      document.addEventListener('click', (e) => {
        const isClickInside = mobileMenu.contains(e.target) || menuToggle.contains(e.target);
        const isOpen = mobileMenu.style.maxHeight !== "0" && !mobileMenu.classList.contains('hidden');

        if (!isClickInside && isOpen) {
          mobileMenu.style.maxHeight = "0";
          mobileMenu.style.opacity = "0";
          setTimeout(() => mobileMenu.classList.add('hidden'), 350);
          line1.style.transform = 'rotate(0deg) translate(0, 0)';
          line2.style.transform = 'rotate(0deg) translate(0, 0)';
        }
      });

      // Shrink header on scroll
      window.addEventListener('scroll', () => {
        if (window.scrollY > 50) {
          header.classList.add('shadow-lg');
          headerContent.classList.add('h-16', 'md:h-20');
          logo.classList.add('h-10', 'md:h-14');
          logo.classList.remove('h-12', 'md:h-16');
          nameImg.classList.add('h-5', 'md:h-6');
          nameImg.classList.remove('h-6', 'md:h-8');
        } else {
          header.classList.remove('shadow-lg');
          headerContent.classList.remove('h-16', 'md:h-20');
          logo.classList.remove('h-10', 'md:h-14');
          logo.classList.add('h-12', 'md:h-16');
          nameImg.classList.remove('h-5', 'md:h-6');
          nameImg.classList.add('h-6', 'md:h-8');
        }
      });
    })
    .catch(err => console.error('Failed to load header:', err));
</script>


<main class="max-w-7xl mx-auto px-4 py-6">
  <h2 id="page-title" class="text-2xl md:text-3xl font-bold text-gray-900 mb-6">Properties</h2>
  <div id="grid" class="grid grid-cols-1 gap-6"></div>
</main>

<a href="tel:+917039199717" class="fixed bottom-4 right-4 z-50 bg-[#0f2b3d] text-white px-4 py-3 rounded-full shadow-lg font-semibold">
  ðŸ“ž Call Now
</a>

<script>
const INR = n => Number(n).toLocaleString('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 });

// Create media slides for carousel
function createMedia(src,type){
  const div = document.createElement('div');
  div.className = 'carousel-item';

  if(type==='image'){
    const img = document.createElement('img');
    img.src = src; img.alt = 'Property Image'; img.className = 'media';
    div.appendChild(img);
  } else {
    if(src.includes('youtube.com') || src.includes('youtu.be')){
      let videoId='';
      if(src.includes('shorts/')) videoId=src.split('shorts/')[1].split('?')[0];
      else if(src.includes('youtu.be/')) videoId=src.split('youtu.be/')[1].split('?')[0];
      else if(src.includes('watch?v=')) videoId=src.split('watch?v=')[1].split('&')[0];

      const thumb = document.createElement('img');
      thumb.src = `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`;
      thumb.className='media cursor-pointer';
      thumb.alt='Video Thumbnail';
      thumb.addEventListener('click',()=> window.open(`https://www.youtube.com/watch?v=${videoId}`,'_blank'));
      div.appendChild(thumb);
    }
  }
  return div;
}

// Create property card
function propertyCard(p){
  const card = document.createElement('article');
  card.className='card bg-white rounded-xl overflow-hidden shadow flex flex-col';

  const carousel = document.createElement('div'); carousel.className='carousel';
  const allMedia=[...(Array.isArray(p.images)? p.images.map(s=>({src:s,type:'image'})):[]),
                  ...(Array.isArray(p.videos)? p.videos.map(s=>({src:s,type:'video'})):[])];

  if(allMedia.length===0){
    const ph = document.createElement('div');
    ph.className='w-full h-48 flex items-center justify-center bg-gray-200 text-gray-400 rounded-xl';
    ph.textContent='No media';
    carousel.appendChild(ph);
  } else allMedia.forEach(m=> carousel.appendChild(createMedia(m.src,m.type)));

  card.appendChild(carousel);

  const body = document.createElement('div'); body.className='p-4 flex flex-col gap-2';
  const title = document.createElement('h3'); title.className='text-lg font-semibold text-gray-900'; title.textContent=p.title||'Property';
  const price = document.createElement('span'); price.className='text-[#0f2b3d] font-bold'; price.textContent=INR(p.price);
  const sub = document.createElement('p'); sub.className='text-gray-600 text-sm';
  let builtupText = p.builtupArea && p.builtupArea.trim()!=="" ? ` | Built-up: ${p.builtupArea} sq ft` : "";
  sub.textContent=`${p.bedrooms} Bed | ${p.bathrooms} Bath | Carpet: ${p.carpetArea} sq ft${builtupText} | ${p.location}`;

  const cta = document.createElement('div'); cta.className='mt-2 flex flex-wrap gap-2';
  const details = document.createElement('a'); details.href=`property-details.html?id=${p.id}`; details.target='_blank';
  details.className='px-3 py-2 rounded bg-[#0f2b3d] text-white text-sm font-semibold hover:bg-[#15425c]'; details.textContent='View Details';
  const call = document.createElement('a'); call.href='tel:+917039199717'; call.className='px-3 py-2 rounded bg-green-600 text-white text-sm font-semibold hover:bg-green-700'; call.textContent='Call';
  cta.append(details,call);

  body.append(title,price,sub,cta);
  card.appendChild(body);
  return card;
}

// Load properties
async function load(category){
  try{
    const BACKEND="https://nirvana-estates-backend.onrender.com";
    const res = await fetch(`${BACKEND}/api/properties`);
    const list = await res.json();
    const grid = document.getElementById('grid'); grid.innerHTML='';
    list.filter(p=> (p.category||'').toLowerCase()===category).forEach(p=> grid.appendChild(propertyCard(p)));
    document.getElementById('page-title').textContent = category.charAt(0).toUpperCase()+category.slice(1)+' Properties';
  }catch(e){
    console.error(e);
    document.getElementById('grid').innerHTML='<div class="text-red-600">Failed to load properties.</div>';
  }
}

// Detect page type from URL
const page = window.location.pathname.includes('rentals') ? 'rentals' : 'buyers';
load(page);
</script>

<!-- Footer -->
  <!-- Copyright Bar -->
  <div class="bg-[#0f2b3d] text-gray-300 text-center text-sm py-4">
    Â© <span id="year"></span> Nirvana Estates. All rights reserved.
  </div>

</footer>

<script>
  document.getElementById('year').textContent = new Date().getFullYear();
</script>

</body>
</html>
